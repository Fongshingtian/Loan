!function(e){var t=function(){this.init()};t.prototype={init:function(){this.ui={},this.ui.applyForm=e("#applyForm"),this.ui.sexSel=e('#applyForm select[name="sex"]').eq(0),this.ui.provinceSel=e('#applyForm select[name="provinceId"]').eq(0),this.ui.citySel=e('#applyForm select[name="cityId"]').eq(0),this.ui.txtProvince=e('#applyForm input[name="homeProvince"]').eq(0),this.ui.txtCity=e('#applyForm input[name="homeCity"]').eq(0),this.ui.productCodeSel=e('#applyForm select[name="productCode"]').eq(0),this.ui.entryAmount=e('#applyForm input[name="entryAmount"]').eq(0),this.ui.periodNumSel=e('#applyForm select[name="periodNum"]').eq(0),this.initData(),this.regEvent(),this.applyFormInit()},initData:function(){var t=this;new window.PhoneVerifyCode({elBtn:e("#btn-send-code"),elPhone:e('#applyForm input[name="mobile"]').eq(0)}),_.isEmpty(this.ui.provinceSel.val())||window.BaseCtrl.areaChangeInit(t.ui.provinceSel,t.ui.citySel,!0).always(function(){var e=t.ui.citySel.attr("data-initCityId");t.ui.citySel.find('option[value="'+e+'"]').attr("selected",!0),t.ui.citySel.selectpicker("refresh")})},regEvent:function(){var e=this;this.ui.provinceSel.on("changed.bs.select",function(){window.BaseCtrl.areaChangeInit(e.ui.provinceSel,e.ui.citySel,!0)}),this.ui.productCodeSel.on("changed.bs.select",function(){var t=e.ui.productCodeSel.val();if(null==t||""==t);else{for(var a=e.ui.productCodeSel.find("option:selected").eq(0),r=a.attr("data-loanMonthNumber").split("/"),i="",n=0;n<r.length;n++)i+='<option value="'+r[n]+'" >'+r[n]+"期</option>";e.ui.periodNumSel.html(i),e.ui.periodNumSel.selectpicker("refresh"),e.ui.periodNumSel.selectpicker("render")}e.applyFormValidator.element(this)}),this.ui.provinceSel.on("changed.bs.select",function(){e.applyFormValidator.element(this)}),this.ui.citySel.on("changed.bs.select",function(){e.applyFormValidator.element(this)}),this.ui.periodNumSel.on("changed.bs.select",function(){e.applyFormValidator.element(this)});var t=window.QueryString().pid;_.isEmpty(t)||setTimeout(function(){e.ui.productCodeSel.val(t),e.ui.productCodeSel.selectpicker("refresh"),e.ui.productCodeSel.trigger("changed.bs.select")},200)},applyFormInit:function(){var t=this;e.validator.addMethod("isEntryAmount",function(e){var a=t.ui.productCodeSel.find("option:selected").eq(0),r=a.attr("data-loanLowerLimit"),i=a.attr("data-loanUpperLimit");r=parseFloat(r)||0,i=parseFloat(i)||0;var n=parseFloat(e)||0;return _.isEmpty(a.val())?!1:n>=r&&i>=r?!0:!1},"贷款额度输入有误!"),e.validator.addMethod("isSelectProduct",function(){var e=t.ui.productCodeSel.find("option:selected").eq(0);return _.isEmpty(e.val())?!1:!0},"请先选择贷款产品！"),e.validator.addMethod("isMatchIDCard",function(){var t,a=e("#sex").find("option:selected").eq(0).val(),r=e("#idCardNo").val();if(15==r.length){{"19"+r.substring(6,12)}t=parseInt(r.charAt(14))%2==0?"0":"1"}else if(18==r.length){{r.substring(6,14)}t=parseInt(r.charAt(16))%2==0?"0":"1"}return a==t?!0:!1});var a=e("#applyForm");this.applyFormValidator=a.validate({rules:{custName:"required",sex:{required:!0,isMatchIDCard:!0},idCardNo:{required:!0,isIDCard:!0},mobile:{required:!0,isPhone:!0},captcha:"required",provinceId:"required",cityId:"required",productCode:"required",entryAmount:{required:!0,isEntryAmount:!0},periodNum:{required:!0,isSelectProduct:!0},loanPurposeText:"required",isAgree:"required"},messages:{custName:"请输入您的姓名",sex:{required:"请选择您的性别",isMatchIDCard:function(){var t,a=e("#sex").find("option:selected").eq(0).val(),r=e("#idCardNo").val();if(15==r.length){{"19"+r.substring(6,12)}t=parseInt(r.charAt(14))%2==0?"0":"1"}else if(18==r.length){{r.substring(6,14)}t=parseInt(r.charAt(16))%2==0?"0":"1"}return a==t?!0:'<span class="text-orange">与身份证上的性别不符</span>'}},idCardNo:{required:"请输入身份证号",isIDCard:"身份证号码格式不正确"},mobile:{required:"请输入手机号码",isPhone:"请您输入正确手机号"},captcha:"请输入手机验证码",provinceId:"请选择省份",cityId:"请选择城市",productCode:"请选择贷款产品",entryAmount:{required:'<span class="text-orange">请输入贷款金额</span>',isEntryAmount:function(a,r){var i=t.ui.productCodeSel.find("option:selected").eq(0);if(_.isEmpty(i.val()))return'<span class="text-orange">请先选择贷款产品！</span>';var n=i.attr("data-loanLowerLimit"),s=i.attr("data-loanUpperLimit");n=parseFloat(n)||0,s=parseFloat(s)||0;var o=parseFloat(e(r).val())||0;return o>=n&&s>=n?!0:'贷款金额为<span class="text-orange">'+n+"-"+s+"</span>元"}},periodNum:{required:'<span class="text-orange">请选择贷款期数</span>',isSelectProduct:function(){var e=t.ui.productCodeSel.find("option:selected").eq(0);return _.isEmpty(e.val())?'<span class="text-orange">请先选择贷款产品！</span>':!0}},loanPurposeText:"请输入贷款用途",isAgree:"请同意协议"},errorClass:"has-error",errorPlacement:function(t,a){e(a).hasClass("selectpicker")?e(a).parent().parent().parent().find(".xn-error").html(t):e(a).hasClass("area-sel")||("isAgree"==e(a).attr("name")?e(a).parent().parent().parent().find(".xn-error").html(t):"captcha"==e(a).attr("name")||"loanPurposeText"==e(a).attr("name")?e(a).parent().parent().find(".xn-error").html(t):e(a).parent().find(".xn-error").html(t))},highlight:function(t,a){e(t).hasClass("selectpicker")?e(t).parent().parent().parent().addClass(a):e(t).hasClass("area-sel")?e(t).parent().parent().addClass(a):"isAgree"==e(t).attr("name")?e(t).parent().parent().parent().addClass(a):"captcha"==e(t).attr("name")||"loanPurposeText"==e(t).attr("name")?e(t).parent().parent().addClass(a):e(t).parent().addClass(a)},success:function(t,a){e(a).hasClass("selectpicker")?e(a).parent().parent().parent().removeClass("has-error").addClass("has-success"):e(a).hasClass("area-sel")?e(a).parent().parent().removeClass("has-error"):"isAgree"==e(a).attr("name")?e(a).parent().parent().parent().removeClass("has-error").addClass("has-success"):"captcha"==e(a).attr("name")||"loanPurposeText"==e(a).attr("name")?e(a).parent().parent().removeClass("has-error").addClass("has-success"):e(a).parent().removeClass("has-error").addClass("has-success")},submitHandler:function(){a.find(".has-error").removeClass("has-error"),t.ui.txtProvince.val(t.ui.provinceSel.find("option:selected").eq(0).text()),t.ui.txtCity.val(t.ui.citySel.find("option:selected").eq(0).text()),e("#btn-loan-apply").addClass("disabled"),window.API.submitLoanApply(a.serialize()).then(function(t){"1"==t.code?location.href=window.BASE_URL+"/loan/apply/success":t.code<=0?(alert(t.msg),e("#btn-loan-apply").removeClass("disabled")):alert("系统异常！")},function(){document.getElementById("applyForm").submit()}).always(function(){e("#btn-loan-apply").removeClass("disabled")})}}),this.ui.sexSel.on("changed.bs.select",function(){e("#idCardNo").val()&&t.applyFormValidator.element(this)}),e("#idCardNo").on("input",function(){18==e("#idCardNo").val().length&&t.applyFormValidator.element(e("#sex").get(0))}),e("idCardNo").on("blur",function(){t.applyFormValidator.element(e("#sex").get(0))})}},e(function(){new t})}($);