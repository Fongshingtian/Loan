// define("page/activity/pointmall/list/js/list",["../../../../../module/page/js/init","../../common/tpl/productItem","../../index/js/cutTime.js"],function(a,t,e){function i(){function a(){u="default",v=0,t(),e.addClass("active")}function t(){i.removeClass("active").attr("data-sortby",0).find("i").html("↓")}var e=$(".js_sort_default"),i=$(".js_sort_points");$("#productAreaList").on("click",".filter",function(){var t,e=$(this);e.hasClass("active")||(e.addClass("active").siblings().removeClass("active"),t=e.attr("data-productareaid"),p="all"==t?"":t,a(),r())}),$("#sortList").on("click",".filter",function(){var a=$(this);u=a.attr("data-sort"),"default"!=u&&a.hasClass("active")&&(v=1*a.attr("data-sortby")?0:1,a.attr("data-sortby",v),a.find("i").html(v?"↑":"↓")),"default"==u?t():e.removeClass("active"),a.addClass("active"),r()}),$("#container").on("click",".sold-out",function(){$.util.alertInfo("商品已售罄，下次早点来哦！")})}function s(){$.get("/common/list",function(a,t,e){var i=a.data||[],s="",r=!1;$(i).each(function(){var a="";r||p!=this.id||(r=!0,a="active"),s+='<span class="filter '+a+'" data-productareaid="'+this.id+'">'+this.name+"</span>"}),s='<span data-productareaid="all" class="filter '+(r?"":"active")+'">全部</span>'+s,$("#productAreaList").html(s),f.init(Date.parse(e.getResponseHeader("Date")))})}function r(){var a="/common/list/",t="sort="+u+"&sortBy="+v;p&&(t+="&productAreaId="+p),c.html(""),l.pages(a,n,null,d,1,20,"list",100,t,null,"get")}function n(a,t,e){var i=a.data||[];return i.length?(i.now=Date.parse(e.getResponseHeader("Date")),d.hide().html($.util.dot(o,i)).fadeIn(300),f.clearAll(),void f.update()):void d.html('<li class="nodata">暂无数据</li>')}var l=a("../../../../../module/page/js/init"),o=a("../../common/tpl/productItem"),d=$("#productList"),c=$("#pages"),p=$.util.getQueryStrObj().productAreaId,u="default",v=0,f=a("../../index/js/cutTime.js");!function(){s(),r(),i()}()}),define("module/page/js/init",[],function(a,t,e){var i=function(a,t,e,i,s,r){s=s||10;var n=e.totalRow/s;r=r||30,$("#pageCal").val(e.totalRow);var l=parseInt(n)>=r?r:n.toString().indexOf(".")>-1?parseInt(n)+1:parseInt(n),o="list"==i?'第<i class="pg">'+(a+1)+'</i>页/共<i class="cal">'+l+'</i>页<a data-page="fast" href="javascript:void(0);">首页</a><a data-page="up" href="javascript:void(0);">上一页</a>':'<span class="l">第<i class="pg">'+(a+1)+'</i>页/共<i class="cal">'+l+'</i>页<a data-page="fast" href="javascript:void(0);">首页</a></span><a class="up" data-page="up" href="javascript:void(0);">上一页</a>',d="list"==i?'<a data-page="down" href="javascript:void(0)">下一页</a><a data-page="last" href="javascript:void(0)">末页</a>':'<a class="down" data-page="down" href="javascript:void(0)">下一页</a><span class="l"><a data-page="last" href="javascript:void(0)">末页</a></span>';switch(t){case"fast":if(l>5)o+='<a data-page="un" class="cur" href="javascript:void(0);">1</a><a data-page="un" href="javascript:void(0);">2</a><a data-page="un" href="javascript:void(0);">3</a><a data-page="un" href="javascript:void(0);">4</a><a data-page="un" href="javascript:void(0);">5</a>';else for(var c=0;c<l;c++)o+='<a data-page="un" href="javascript:void(0);">'+(c+1)+"</a>";$("div.page").html(o+d),$(".page a[data-page='un']:first").addClass("cur");break;case"up":if(a<4&&l>=5){for(var c=1;c<6;c++)o+='<a data-page="un" href="javascript:void(0);">'+c+"</a>";$("div.page").html(o+d),$(".page a[data-page='un']:contains('"+(a+1)+"')").addClass("cur")}else if(a<4&&l<5){for(var p=parseInt(l)+1,c=1;c<p;c++)o+='<a data-page="un" href="javascript:void(0);">'+c+"</a>";$("div.page").html(o+d),$(".page a[data-page='un']:contains('"+(a+1)+"')").addClass("cur")}else{for(var c=a-2;c<a+3;c++)o+='<a data-page="un" href="javascript:void(0);">'+c+"</a>";$("div.page").html(o+d),$(".page a[data-page='un']:last").prev().addClass("cur")}break;case"down":var p=parseInt(l)+1;if(l-5<a&&l>0){for(var c=l-4;c<p;c++)o+='<a data-page="un" href="javascript:void(0);">'+c+"</a>";$("div.page").html(o+d),$(".page a[data-page='un']:contains('"+(a+1)+"')").addClass("cur")}else{for(var c=a;c<a+5;c++)o+='<a data-page="un" href="javascript:void(0);">'+c+"</a>";$("div.page").html(o+d),$("div.page a[data-page='un']:eq(1)").addClass("cur")}break;case"last":if(l>a)for(var u=l-5>0?l-5:0,c=u;c<l;c++)o+='<a data-page="un" href="javascript:void(0);">'+(c+1)+"</a>";$("div.page").html(o+d),$("div.page a[data-page='un']:last").addClass("cur")}$(".page i.pg").html(a+1)};t.pages=function(a,t,e,s,r,n,l,o,d,c,p){var p=p?p:"get",r=r||1,n=n||10,d=d?"?"+d:"",c=c||1,u='<img src="'+window.global.staticPath+'/images/loading-44bbc291bc.gif" />',v=function(e,r){$(s).html('<span class="loding-img">'+u+"</span>"),e=e-1||0,$.ajaxSetup({cache:!1}),$[p](a+e+"/"+n+d,function(a,s,d){var a="object"==typeof a?a=a||{}:JSON.parse(a);0!=a.totalRow&&null!=a.totalRow&&i(e,r,a,l,n,o),t(a,c,d)},"json")},f=function(a){var t=$(a),e=$("a[data-page='un']:first"),i=$("a[data-page='un']:last"),s="un"==t.attr("data-page")?parseInt(t.html()):parseInt($(".page a[data-page='un'].cur").html()),r=parseInt($(".page .cal").html());switch(t.attr("data-page")){case"fast":1!=s&&v(1,"fast");break;case"up":if(e.next().hasClass("cur")&&1!=s)v(s-1,"up");else{if(e.hasClass("cur")&&1==s)return;$(".page .cur").prev().addClass("cur").siblings().removeClass("cur"),v(s-1)}break;case"un":$(".page a[data-page='un'].cur").html()!=t.html()&&(e.html()==t.html()&&1!=t.html()?v(parseInt(t.html()),"up"):i.html()==t.html()&&t.html()!=r?v(parseInt(t.html()),"down"):(t.addClass("cur").siblings().removeClass("cur"),v(parseInt(t.html()))));break;case"down":if(i.prev().hasClass("cur")&&s!=r-1)v(s+1,"down");else{if(i.hasClass("cur")&&s==r)return;$(".page .cur").next().addClass("cur").siblings().removeClass("cur"),v(s+1)}break;case"last":r!=s&&v(r,"last")}},g=function(){$("div.page").delegate("a","click",function(a){return a.preventDefault(),f(this),!1})};return g(),v(r,"fast"),this}}),define("page/activity/pointmall/common/tpl/productItem",[],function(a,t,e){e.exports=function(a){var t="",e=a||[],i=e;if(i)for(var s,r=-1,n=i.length-1;r<n;)s=i[r+=1],t+='<li> <a href="/vip/mall/detail'+s.id+'" ',8==s.category&&(t+='data-statistics-baidu="积分商城,忠粉值sku"'),t+=' > <img src="'+s.picUrl+'" /> </a> <div> <p class="name" title="'+s.productName+'">'+s.productName+'</p> <p class="orange">积分：'+s.points+"</p>  ",s.realSaleTime>e.now&&s.showProductStock?t+=' <p class="cut-time" data-time="'+s.realSaleTime+'" data-num="'+s.totalNumber+'"></p> ':s.realSaleTime>e.now?t+=' <p class="cut-time" data-time="'+s.realSaleTime+'"></p> ':s.showProductStock&&(t+=' <p class="gray">库存：'+s.totalNumber+"</p> "),t+=" </div> ",s.extension&&s.extension.labelName&&(t+=' <label class="label">'+s.extension.labelName.substring(0,3)+"</label> "),t+=" ",2==s.productStatus&&(t+=' <div class="sold-out"> <div class="sold-out-bg"></div> <div class="sold-out-img"></div> </div> '),t+="</li>";return t}}),define("page/activity/pointmall/index/js/cutTime",[],function(a,t,e){function i(a){return a=Number(a),a<10?"0"+String(a):String(a)}var s={cbAy:[],now:"",isTiming:!1,init:function(a,t){return"number"!=typeof a?(console.log("获取时间错误"),!1):(this.now=a,this.isTiming||this.timeCount(),this.isTiming=!0,void(t&&this.update()))},update:function(){$(".cut-time").each(function(a,t){if(!$(this).attr("timing")){var e={dom:this,start:Number($(this).attr("data-time")),update:function(a){var t=this.start,e=new Date(t),r=t-a,n=!(r>3600*e.getHours()*1e3+60*e.getMinutes()*1e3+1e3*e.getSeconds());if(r/=1e3,n)if(r>0){var l=i(Math.floor(r/3600)),o=i(Math.floor((r-3600*l)/60)),d=i(Math.floor(r-3600*l-60*o));this.dom.innerHTML=l+":"+o+":"+d+" 后开抢"}else s.clear(this),$(this.dom).attr("data-num")?($(this.dom).removeClass("cut-time").addClass("gray"),$(this.dom).html("库存 ： "+$(this.dom).attr("data-num"))):$(this.dom).css("display","none");else this.dom.innerHTML=$.util.formatTime(e,"MM月dd日 HH:mm:ss")+"开抢"}};s.on(e),$(this).attr("timing",!0)}})},on:function(a){this.cbAy.push(a),a.update(this.now)},clear:function(a){for(var t=0;t<this.cbAy.length;t++)if(this.cbAy[t].dom==a.dom)return this.cbAy.splice(t,1),!0},clearAll:function(){for(var a=0;a<this.cbAy.length;a++)this.cbAy=[]},timeCount:function(){var a=this;this.now=this.now+1e3;setInterval(function(){for(var t=0;t<a.cbAy.length;t++)a.cbAy[t].update(a.now);a.now=a.now+1e3},1e3)}};return s});