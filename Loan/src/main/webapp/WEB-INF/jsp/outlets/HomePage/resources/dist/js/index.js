var IndexPage=function(){this.init()};IndexPage.prototype={init:function(){this.ui={},this.ui.applyLoanForm="#applyLoanForm",this.ui.applyFormSexSel=$('#applyLoanForm select[name="sex"]').eq(0),this.ui.applyFormProvinceSel=$('#applyLoanForm select[name="provinceId"]').eq(0),this.ui.applyFormCitySel=$('#applyLoanForm select[name="cityId"]').eq(0),this.ui.applyFormProvince=$('#applyLoanForm input[name="homeProvince"]').eq(0),this.ui.applyFormCity=$('#applyLoanForm input[name="homeCity"]').eq(0),this.ui.busFormProvinceSel=$('#businessOutletsForm select[name="province"]').eq(0),this.ui.busFormCitySel=$('#businessOutletsForm select[name="city"]').eq(0),this.ui.btnBranchSearch=$("#btn-branch-search"),this.ui.newsTpl=$(".news-list-detail").find('[name="index-news-content"]'),this.initData(),this.fixRightToolsScrollFixed(),this.applyFormInit(),this.regEvent(),this.fixedIEBug()},initData:function(){this.ui.newsTpl.each(function(){var e=$($(this).html()).find("p").eq(0).html();e=_.isEmpty(e)?$(this).html():e.replace(/<[^>]+>/g,"").substring(0,75),$(this).next().prepend(e)})},regEvent:function(){var e=this;this.ui.applyFormProvinceSel.on("change",function(){window.BaseCtrl.areaChangeInit(e.ui.applyFormProvinceSel,e.ui.applyFormCitySel)}),this.ui.applyFormCitySel.on("change",function(){e.applyFormValidator.element(this)}),this.ui.busFormProvinceSel.on("changed.bs.select",function(){window.BaseCtrl.areaChangeInit(e.ui.busFormProvinceSel,e.ui.busFormCitySel,!0)}),$(".news-list-detail").hide().eq(0).show(),$("#carousel-news").on("slid.bs.carousel",function(e){var t=$(e.relatedTarget).attr("data-newsid");$(".news-list-detail").hide(),$('.news-list-detail[data-newsid="'+t+'"]').show()})},applyFormInit:function(){var e=this,t=$("#applyLoanForm");$.validator.addMethod("isRequiredCityId",function(){var t=e.ui.applyFormProvinceSel.find("option:selected").eq(0),i=e.ui.applyFormCitySel.find("option:selected").eq(0);return t.text()==i.text()?!0:_.isEmpty(i.val())?!1:!0},"请选择城市"),this.applyFormValidator=t.validate({rules:{custName:"required",mobile:{required:!0,isPhone:!0},isAgree:"required"},messages:{custName:"请输入您的姓名",mobile:{required:"请输入手机号码",isPhone:"手机号码不正确"},isAgree:"请同意协议"},errorClass:"has-error",errorPlacement:function(e,t){var i,s=$(t);i=s.hasClass("selectpicker")||"isAgree"==s.attr("name")?s.parent().parent().parent():$(t).hasClass("area-sel")?s.parent().parent():s.parent(),i.popover({html:!0,title:"",container:"body",placement:document.body.offsetWidth>1550?"right":"left",content:'<p class="text-danger">'+e[0].innerHTML+"</p>"}),i.popover("show")},highlight:function(e,t){var i,s=$(e);i=s.hasClass("selectpicker")||"isAgree"==s.attr("name")?s.parent().parent().parent():$(e).hasClass("area-sel")?s.parent().parent():s.parent(),i.removeClass("has-success"),i.addClass(t)},success:function(e,t){var i,s=$(t);i=s.hasClass("selectpicker")||"isAgree"==s.attr("name")?s.parent().parent().parent().removeClass("has-error").addClass("has-success"):s.hasClass("area-sel")?s.parent().parent().removeClass("has-error"):s.parent().removeClass("has-error").addClass("has-success"),i.popover("destroy")},submitHandler:function(i){t.find(".has-error").removeClass("has-error");e.ui.applyFormProvinceSel.val(),e.ui.applyFormCitySel.val();e.ui.applyFormProvince.val(e.ui.applyFormProvinceSel.find("option:selected").eq(0).text()),e.ui.applyFormCity.val(e.ui.applyFormCitySel.find("option:selected").eq(0).text()),i.submit()}}),this.ui.applyFormSexSel.on("changed.bs.select",function(){e.applyFormValidator.element(this)}),this.ui.applyFormSexSel.on("loaded.bs.select",function(){$(this).parent().parent().removeClass("form-control")}),$("body").click(function(i){var s=$(i.target);0==s.closest(".q-l-form").length&&(console.log("resetForm"),t.find(".has-error").removeClass("has-error").popover("destroy"),e.applyFormValidator.resetForm())})},fixRightToolsScrollFixed:function(){function e(){var e=t.scrollTop();i.css(e>s-a?window.XMLHttpRequest?{position:"fixed",top:a}:{top:e}:{position:"absolute",top:s})}var t=$(window),i=$(".BizQQWPA_wrap"),s=(i.offset().top,$("#index-content-list").offset().top),a=t.height()/2-i.height()/2;i.css({position:"absolute",top:s}),e(),t.scroll(e)},fixedIEBug:function(){}},$(function(){new IndexPage});