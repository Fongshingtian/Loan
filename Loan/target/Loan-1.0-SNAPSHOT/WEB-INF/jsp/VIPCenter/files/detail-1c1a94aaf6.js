define("page/activity/pointmall/detail/js/detail",["../tpl/contanier","./cutTime.js"],function(t,i,e){function a(){var t=$("#exchangeNum"),i=r.mallProductDTO||{},e=i.extension||{},a=e.limitExchangeNum||0,o=0;return $(".buynow")[0].disabled?(t[0].disabled=!0,void($("#exchange")[0].action="")):(o=a?Math.min(a-(r.currentDateExchangeNum||0),r.exchangeNum):r.exchangeNum,o=o>0?o:0,n(t,o),s(t,o),void $(".buynow").click(function(){if($(this).attr("class").indexOf("cut-time")!=-1)return console.log(99),!1}))}function n(t,i){l.on("click",".js_minus",function(){var i=1*t.val();return i?void(i>1&&t.val(i-1)):void t.val(1)}),l.on("click",".js_plus",function(){var e=1*t.val();return e?void(e<i&&t.val(e+1)):void t.val(1)}),t.on("input, keyup",function(t){var i=$(this),e=i.val();t=t?t:window.event?window.event:"";var a=t.keyCode?t.keyCode:t.which;return""!==e&&e==i.data("value")||8==a||9==a||46==a||13==a||(this.value=this.value.replace(/[^\d]/g,""),this.value=this.value.replace(/\b(0+)/gi,"")),i.data("value",e),!1})}function s(t,i){$("#exchange").submit(function(e){var a=1*t.val().trim(),n=this.action+"&num="+a;return e.preventDefault(),window.global.isLogin?!a||isNaN(a)?void $.toast.tip("请输入正确数字"):r.userPoint<(r.mallProductDTO||{}).points?void $.toast.tip("积分不足"):a>i?void $.toast.tip("该商品今日尚可兑"+i+"件",2e3):(this.action=n,void this.submit()):void gotoLogin("/user/login")})}var o=t("../tpl/contanier"),l=$("#detailContainer"),u=t("./cutTime.js"),r={},c=function(){var t=location.pathname.split("/usual/detail/")[1]||"1";return t.indexOf("?")>-1&&(t=t.split("?")[0]),t.indexOf("#")>-1&&(t=t.split("#")[0]),t.indexOf("/")>-1&&(t=t.split("/")[0]),t||0}();(function(){return c?void $.post("/activity/pointmall/usual/detailInfo/"+c,function(t,i,e){var n=t||{},s=n.mallProductDTO||{};n.exchangeNum=n.exchangeNum||0,n.currentDateExchangeNum=n.currentDateExchangeNum||0,r=n,n.now=Date.parse(e.getResponseHeader("Date")),l.html($.util.dot(o,n)),$("#breadcrumb").append(s.productName||""),u.init(n.now),a()}):void l.html('<div class="g-tc" style="padding-top: 210px;">暂无数据</div>')})()}),define("page/activity/pointmall/detail/tpl/contanier",[],function(t,i,e){e.exports=function(t){var i="",e=t||{},a=e.mallProductDTO||{},n=a.extension||{},s=a.category,o={0:"天",1:"个月"},l={5:"会员专享标",6:"微信专享标",7:"APP专享标",9:"转让标",16:"新手标",17:"存续牛",18:"个人专享标",19:"散标",20:"安稳投",21:"升财牛",22:"优享牛"},u=function(){var t="",i=l,e=n.allowProductTypeArr||[],a=e.length;if(!a)return"暂无可使用的产品";if(17==a)return"仅不适用于体验标";if(a<=9){for(var s=0;s<a;s++)t+="、"+i[e[s]];return"仅适用于"+t.slice(1)}if(a>9){for(var o=0;o<a;o++)delete i[e[o]];for(var u in i)i[u]&&(t+="、"+i[u]);return"不适用于"+t.slice(1)}}();if(i+='<div class="prd-box g-cf section"> <div class="prd-photo"> <img src="'+a.picUrl+'" width="400" height="400" border="0" /> ',n.labelName&&(i+=' <label class="label">'+n.labelName.substring(0,3)+"</label> "),i+=' </div> <div class="prd-trade"> <form method="post" id="exchange" action="/activity/pointmall/confirmOrExchange?id='+a.id+'"> <input type="hidden" value="'+a.id+'" name="productId" /> <h1>'+a.productName+'</h1> <p class="prd-price">所需积分：'+a.points+"</p> ",i+=window.global.isLogin?" <p>可用积分："+(e.userPoint||0)+"</p> ":" <p>可用积分：--</p> ",i+=" <p>库存："+(a.totalNumber||0)+" </p>  ",1!=s&&5!=s||(i+=' <p class="height-auto">使用条件：单笔满'+(n.investAmount||"--")+"元，期限不小于"+(n.investDeadline||"--")+"个月<br />（"+u+"）</p> "),i+=" ",5==s&&(i+=" <p>增利时间段： ",i+=(n.interestPeriod||0)>0?" 前"+n.interestPeriod+o[n.interestTimeUnit]+"增利  ":" 全程增利 ",i+=" </p> "),i+=" ",1==s||2==s||5==s||6==s){var r,c;2==n.validTimeType&&n.validTime&&(c=$.util.formatTime(n.validTime,"yyyy年MM月dd日 HH:mm:ss")),r=a.realSaleTime||a.saleTime,r&&(r=$.util.formatTime(r,"yyyy年MM月dd日 HH:mm:ss")),i+=" ",i+=c?' <p class="height-auto">有效期限：'+(r+" - "+c)+"</p> ":n.validDays?' <p class="height-auto">有效期限：'+(n.validDays||"")+"天</p> ":' <p class="height-auto">有效期限：仅兑换当天可用</p> ',i+="  "}return i+=" ",n.limitExchangeNum&&(i+=" <p>限兑：每人每天限兑"+n.limitExchangeNum+"件</p> "),i+=' <p class="opt-box"> <span class="g-fl">选择数量：</span> <a href="javascript:;" name="minus" class="js_minus opt-btn">-</a> <input type="text" id="exchangeNum" class="count" name="count" value="1" /> <a href="javascript:;" name="plus" class="js_plus opt-btn">+</a> </p> ',i+=window.global.isLogin?0==a.productStatus?' <input type="submit" class="buynow disabled" disabled="disabled" value="商品已下架">  ':2==a.productStatus?' <input type="submit" class="buynow disabled" disabled="disabled" value="商品已售罄">  ':e.exchangeNum<=0?' <input type="submit" class="buynow disabled" disabled="disabled" value="马上兑换">  ':n.limitExchangeNum&&e.currentDateExchangeNum>=n.limitExchangeNum?' <input type="submit" class="buynow disabled" disabled="disabled" value="今日兑换已达上限">  ':a.realSaleTime&&a.realSaleTime>e.now?' <input type="submit" class="buynow cut-time" data-time="'+a.realSaleTime+'" value="测试">  ':8==s?' <input type="submit" data-statistics-baidu="积分商城,积分兑换-忠粉值sku-立即兑换" class="buynow" value="马上兑换"> ':' <input type="submit" class="buynow" value="马上兑换"> ':' <input type="submit" class="buynow" value="登录兑换">  ',i+=" </form> </div></div>",!a.content||1!=a.productType&&8!=s||(i+=' <div class="prd-introduce"> <div class="section"> <div class="introduce-title"><h2>商品介绍</h2></div> '+a.content+" </div> </div>"),i}}),define("page/activity/pointmall/detail/js/cutTime",[],function(t,i,e){function a(t){return t=Number(t),t<10?"0"+String(t):String(t)}var n={cbAy:[],now:"",init:function(t){this.now=t,this.timeCount(),$(".cut-time").each(function(t,i){if(!$(this).attr("timing")){var e={dom:this,start:Number($(this).attr("data-time")),update:function(t){var i=this.start,e=new Date(i),s=i-t,o=!(s>3600*e.getHours()*1e3+60*e.getMinutes()*1e3+1e3*e.getSeconds());if(s/=1e3,o)if(s>0){var l=a(Math.floor(s/3600)),u=a(Math.floor((s-3600*l)/60)),r=a(Math.floor(s-3600*l-60*u));this.dom.value=l+":"+u+":"+r+" 后开抢"}else n.clear(this),$(this.dom).removeClass("cut-time"),this.dom.value="马上兑换";else this.dom.value=$.util.formatTime(e,"MM月dd日 HH:mm:ss")+"开抢"}};n.on(e),$(this).attr("timing",!0)}})},on:function(t){this.cbAy.push(t),t.update(this.now)},clear:function(t){for(var i=0;i<this.cbAy.length;i++)if(this.cbAy[i].dom==t.dom)return this.cbAy.splice(i,1),!0},timeCount:function(){var t=this;this.now=this.now+1e3;setInterval(function(){for(var i=0;i<t.cbAy.length;i++)t.cbAy[i].update(t.now);t.now=t.now+1e3},1e3)}};return n});